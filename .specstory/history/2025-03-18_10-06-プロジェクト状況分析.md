## SpecStory

## プロジェクト状況分析 (2025/3/18 10:06:17)

_**User**_

このプロジェクトの状況を分析してください。

---

_**Assistant**_

プロジェクトの状況を分析するために、まずファイル構造を確認し、実装状況を調べてみましょう。

---

_****_

<details>
            <summary>Listed current directory • **6** results</summary>
        
| Name |
|-------|
| 📁 `.specstory` |
| 📁 `config` |
| 📁 `docs` |
| 📁 `lib` |
| 📁 `templates` |
| 📁 `tasks` |

</details>

---

_****_

設計書に記載された構造と実際のディレクトリ構造を比較してみましょう。次に、主要なディレクトリの内容を確認します。

---

_****_

<details>
            <summary>Listed directory lib • **3** results</summary>
        
| Name |
|-------|
| 📁 `core` |
| 📁 `commands` |
| 📁 `utils` |

</details>

---

_****_

<details>
            <summary>Listed directory tasks • **0** results</summary>
        
No results found
</details>

---

_****_

プロジェクトの分析結果をまとめます：

1. **ディレクトリ構造の整備状況**:
   - 設計書に記載された基本的なディレクトリ構造は作成済み
   - `.specstory/` という追加のディレクトリが存在（設計書には記載なし）
   - メインスクリプト `task.sh` が見当たらない

2. **実装状況**:
   - `lib/` ディレクトリは設計書通りの構造（core/, commands/, utils/）
   - `tasks/` ディレクトリは空の状態
   - `templates/` と `config/` ディレクトリは存在するが、内容は未確認

3. **設計と実装のギャップ**:
   - データファイル（tasks.yaml, project.tasks）が未作成
   - テンプレートファイル（default.template等）の実装状況が不明
   - メインスクリプトの実装が見当たらない

4. **懸念点**:
   - データストレージとなるYAMLファイルが未作成
   - テンプレートシステムの実装状況が不明
   - コアモジュールの実装状況の確認が必要

5. **次のステップとして推奨される作業**:
   1. メインスクリプト `task.sh` の作成
   2. 基本的なデータファイル（tasks.yaml）の作成
   3. テンプレートファイルの実装
   4. コアモジュールの実装状態の確認と必要な実装の開始

6. **プロジェクトの現状**:
   - 基本的なディレクトリ構造は整備されている
   - 実装フェーズの初期段階にあると判断される
   - 設計書は詳細に記載されており、実装の指針は明確

このプロジェクトは設計フェーズから実装フェーズへの移行期にあると判断されます。設計書は非常に詳細に記載されており、実装の方向性は明確です。次のステップとして、基本的なデータ構造とコア機能の実装から始めることが推奨されます。

コマンドを実行して具体的な実装状況を確認しましょうか？または、特定の実装から始めることをご希望されますか？

---

_**User**_

では設計書のとおりに実装をすすめるタスク@development_tasks.md を見直して、task.sh作成からすすめて
ちなみにtaskコマンドにまとめるつもりだからね。スクリプトを。
task startで初期tasksフォルダを作成してそこにタスク用のファイルを集める感じね。configに今あるtemplateもtasksフォルダに作成されるのかな？
まずは実装のまえに今の観点が設計されているか分析して、設計ドキュメントを修正して

---

_**Assistant**_

ご指摘ありがとうございます。`task start`コマンドの概念は現在の設計書に含まれていないため、まず設計書の分析と修正から始めましょう。

現状の設計と新しい要件の差分を分析します：

1. **初期化コマンドの不在**
   - 現設計: 初期化プロセスが明示的に定義されていない
   - 新要件: `task start`による初期化プロセスが必要

2. **ファイル配置の考え方の違い**
   - 現設計: configとtemplatesは独立したディレクトリ
   - 新要件: tasksディレクトリに集約する可能性

3. **コマンド体系の整理**
   - 現設計: 個別のシェルスクリプトとして実装
   - 新要件: 単一の`task`コマンドにサブコマンドとして統合

設計書に追加すべき内容を整理します：

---

_****_

```diff
  
  ### 3.1 コアモジュール
+ 
+ #### 3.1.0 task_init.sh
+ タスク管理システムの初期化を担当するモジュール。
+ 
+ **主要関数**:
+ - `initialize_task_system()`: タスク管理システムの初期化
+   - tasksディレクトリの作成
+   - 必要なサブディレクトリの作成
+   - 初期設定ファイルの配置
+   - デフォルトテンプレートの配置
+ - `validate_system_requirements()`: 必要なツール（yq, jq）の存在確認
+ - `create_initial_structure()`: ディレクトリ構造の作成
+ 
+ **使用例**:
+ ```bash
+ task start        # システムの初期化
+ task init         # 既存のシステムの再初期化（データは保持）
+ ```
  
  #### 3.1.1 yaml_processor.sh
  ### 3.2 コマンドモジュール
  
- 各コマンドモジュールは特定の機能を実装し、コアモジュールの関数を呼び出して処理を行います。
+ ### 3.2.0 メインコマンドインターフェース
+ すべてのコマンドは単一の`task`コマンドのサブコマンドとして実装されます。
+ 
+ **基本構造**:
+ ```bash
+ task <subcommand> [options] [arguments]
+ ```
+ 
+ **主要サブコマンド**:
+ - `start`: システムの初期化
+ - `init`: システムの再初期化
+ - `add`: タスクの追加
+ - `subtask`: サブタスクの追加
+ - `status`: ステータスの変更
+ - `list`: タスク一覧の表示
+ - `template`: テンプレートの操作
+ - `sync`: データと表示の同期
+ - `sort`: タスクの並び替え
  
  #### 3.2.1 task_add.sh
```

---

_****_

次に、development_tasksも更新する必要があります：

---

_****_

```diff
  - [x] 設定ファイルの作成
  - [x] 依存関係の確認と必要なツールのインストール確認（yq, jq）
+ - [ ] 初期化コマンド（task start/init）の実装
+ - [ ] メインの task コマンドスクリプトの実装
  
  ## 2. コアモジュール実装
  - [x] 既存のtask_processor.shの修正
  - [ ] 共通ユーティリティ関数の実装
+ - [ ] 初期化モジュール（task_init.sh）の実装
  
  ## 3. コマンドモジュール実装
```

---

_****_

設計の変更点をまとめます：

1. **ファイル構造の変更**
   - すべてのタスク関連ファイルを`tasks/`ディレクトリに集約
   - テンプレートと設定ファイルも`tasks/`配下に移動

2. **新しいコマンド体系**
   - 単一の`task`コマンドに統合
   - サブコマンドとして機能を提供
   - `start`と`init`コマンドの追加

3. **初期化プロセスの追加**
   - `task_init.sh`モジュールの新設
   - システム要件の検証機能
   - ディレクトリ構造の自動生成

4. **開発タスクの更新**
   - 初期化コマンドの実装タスクを追加
   - メインコマンドスクリプトの実装タスクを追加

これらの変更により、以下の利点が得られます：
1. より整理された一貫性のあるファイル構造
2. 直感的なコマンドインターフェース
3. 明確な初期化プロセス
4. 保守性の向上

次のステップとして、`task.sh`メインスクリプトの実装から始めることをお勧めします。その後、`task start`コマンドの実装に移ることで、基本的なシステム構造を確立できます。

実装を開始してよろしいでしょうか？

---

_**User**_

じゃあファイル構造にもcommandsにたさなきゃじゃね

---

_**Assistant**_

はい、その通りですね。`task_init.sh`をcommandsディレクトリにも追加する必要があります。設計書のファイル構造を更新しましょう。

---

_****_

```diff
  │   │   ├── task_processor.sh     # 基本的なタスク処理関数
  │   │   ├── yaml_processor.sh     # YAMLデータ操作関数
+ │   │   ├── task_init.sh         # 初期化処理関数
  │   │   └── template_engine.sh    # テンプレート処理関数
  │   ├── commands/
+ │   │   ├── task_init.sh         # 初期化コマンド
  │   │   ├── task_add.sh           # タスク追加コマンド
  │   │   ├── task_subtask.sh       # サブタスク追加コマンド
```

---

_****_

この変更により、以下の構造が明確になりました：

1. **コアモジュール側（lib/core/task_init.sh）**
   - 初期化に関する基本的な関数を提供
   - 他のコアモジュールから利用可能な共通機能を実装
   - システム要件の検証やディレクトリ構造の作成などの低レベル機能を担当

2. **コマンドモジュール側（lib/commands/task_init.sh）**
   - `task start` と `task init` コマンドの実装
   - コマンドライン引数の解析
   - ユーザーとのインタラクション処理
   - コアモジュールの機能を呼び出してタスク管理システムを初期化

この分離により：
- 責務の明確な分離
- コードの再利用性の向上
- テストの容易さ
- 保守性の向上

が期待できます。

実装を開始する前に、この構造で問題ないかご確認いただけますでしょうか？

---

_**User**_

では、設計実装のプランをタスクリストへ反映させて、実装スタートさせて。実装は常に目論見と実際を言語化しながら実況して、タスクリストを都度更新してくださいね。

---

_**Assistant**_

はい、まずタスクリストを更新して、実装の詳細な計画を立てましょう。

---

_****_

```diff
  # タスク管理システム開発タスクリスト
  
- ## 1. 基盤構築
+ ## 1. 基盤構築 🚀
  
  - [x] 設計ドキュメントの作成
  - [x] 設定ファイルの作成
  - [x] 依存関係の確認と必要なツールのインストール確認（yq, jq）
+ - [ ] メインの task コマンドスクリプトの実装
+   - [ ] 基本的なコマンド構造の実装
+   - [ ] サブコマンドのディスパッチ機能
+   - [ ] ヘルプメッセージの実装
+   - [ ] エラーハンドリングの基本実装
  - [ ] 初期化コマンド（task start/init）の実装
- - [ ] メインの task コマンドスクリプトの実装
+   - [ ] ディレクトリ構造作成機能
+   - [ ] 初期設定ファイルの配置
+   - [ ] テンプレートファイルの配置
+   - [ ] 依存関係チェック機能
  
  ## 2. コアモジュール実装
  
+ - [ ] 初期化モジュール（lib/core/task_init.sh）の実装
+   - [ ] システム要件検証機能
+   - [ ] ディレクトリ構造作成機能
+   - [ ] 初期ファイル生成機能
  - [x] YAMLデータ操作モジュール（yaml_processor.sh）の実装
  - [x] テンプレートエンジン（template_engine.sh）の実装
  - [x] 既存のtask_processor.shの修正
  - [ ] 共通ユーティリティ関数の実装
- - [ ] 初期化モジュール（task_init.sh）の実装
+   - [ ] ログ出力機能
+   - [ ] エラーハンドリング機能
+   - [ ] 入力検証機能
  
  ## 3. コマンドモジュール実装
  
+ - [ ] 初期化コマンド（lib/commands/task_init.sh）の実装
+   - [ ] startコマンドの実装
+   - [ ] initコマンドの実装
+   - [ ] コマンドライン引数の処理
  - [ ] task_add.shの修正（YAMLデータ形式対応）
  - [ ] task_subtask.shの修正（YAMLデータ形式対応）
  ## 5. テストと検証
  
- - [ ] 基本機能のテスト（タスク追加、サブタスク追加、ステータス変更）
+ - [ ] 基本機能のテスト
+   - [ ] 初期化機能のテスト
+   - [ ] タスク追加機能のテスト
+   - [ ] サブタスク追加機能のテスト
+   - [ ] ステータス変更機能のテスト
  - [ ] テンプレート機能のテスト
  - [ ] 複数タスク一括操作のテスト
  - [ ] エラー処理の強化
  - [ ] ユーザーフィードバックに基づく改善
+ 
+ ## 作業ログ
+ 
+ ### 2024-03-18
+ - 設計ドキュメントの更新: task startコマンドの追加
+ - ファイル構造の見直し: tasksディレクトリへの集約
+ - 実装計画の詳細化
  
  ## 注意点
```

---

_****_

それでは、実装を開始します。まず、メインの`task.sh`スクリプトから実装を始めましょう。

---

_****_

```diff
- 
+ #!/bin/bash
+ 
+ # タスク管理システムのメインスクリプト
+ 
+ # スクリプトが存在するディレクトリの絶対パスを取得
+ SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
+ 
+ # 共通の設定と関数をインポート
+ source "${SCRIPT_DIR}/lib/utils/common.sh"
+ source "${SCRIPT_DIR}/lib/utils/validators.sh"
+ 
+ # バージョン情報
+ VERSION="0.1.0"
+ 
+ # ヘルプメッセージの表示
+ show_help() {
+     cat << EOF
+ Task Management System v${VERSION}
+ 
+ Usage:
+     task <command> [options] [arguments]
+ 
+ Commands:
+     start       Initialize the task management system
+     init        Re-initialize the system (preserves existing data)
+     add         Add new task(s)
+     subtask     Add subtask(s) to an existing task
+     status      Change task status
+     list        List all tasks
+     template    Manage task templates
+     sync        Synchronize task data and display
+     sort        Sort tasks
+     help        Show this help message
+ 
+ Options:
+     -h, --help     Show this help message
+     -v, --version  Show version information
+ 
+ For more information about a command:
+     task help <command>
+ EOF
+ }
+ 
+ # バージョン情報の表示
+ show_version() {
+     echo "Task Management System v${VERSION}"
+ }
+ 
+ # コマンドの実行
+ execute_command() {
+     local command=$1
+     shift # コマンドを削除して残りの引数を保持
+ 
+     case $command in
+         start)
+             source "${SCRIPT_DIR}/lib/commands/task_init.sh"
+             task_start "$@"
+             ;;
+         init)
+             source "${SCRIPT_DIR}/lib/commands/task_init.sh"
+             task_init "$@"
+             ;;
+         add)
+             source "${SCRIPT_DIR}/lib/commands/task_add.sh"
+             task_add "$@"
+             ;;
+         subtask)
+             source "${SCRIPT_DIR}/lib/commands/task_subtask.sh"
+             task_subtask "$@"
+             ;;
+         status)
+             source "${SCRIPT_DIR}/lib/commands/task_status.sh"
+             task_status "$@"
+             ;;
+         list)
+             source "${SCRIPT_DIR}/lib/commands/task_list.sh"
+             task_list "$@"
+             ;;
+         template)
+             source "${SCRIPT_DIR}/lib/commands/task_template.sh"
+             task_template "$@"
+             ;;
+         sync)
+             source "${SCRIPT_DIR}/lib/commands/task_sync.sh"
+             task_sync "$@"
+             ;;
+         sort)
+             source "${SCRIPT_DIR}/lib/commands/task_sort.sh"
+             task_sort "$@"
+             ;;
+         help)
+             if [ $# -eq 0 ]; then
+                 show_help
+             else
+                 # 各コマンドのヘルプを表示（未実装）
+                 echo "Detailed help for $1 command is not implemented yet."
+             fi
+             ;;
+         *)
+             echo "Error: Unknown command '$command'"
+             echo "Run 'task help' for usage information"
+             exit 1
+             ;;
+     esac
+ }
+ 
+ # メイン処理
+ main() {
+     # 引数がない場合はヘルプを表示
+     if [ $# -eq 0 ]; then
+         show_help
+         exit 0
+     fi
+ 
+     # オプションの処理
+     case $1 in
+         -h|--help)
+             show_help
+             exit 0
+             ;;
+         -v|--version)
+             show_version
+             exit 0
+             ;;
+         *)
+             execute_command "$@"
+             ;;
+     esac
+ }
+ 
+ # スクリプトの実行
+ main "$@" 
```

---

_****_

次に、共通ユーティリティ関数を実装します。まず、`common.sh`から始めましょう：

---

_****_

```diff
- 
+ #!/bin/bash
+ 
+ # 共通ユーティリティ関数
+ 
+ # カラー定義
+ RED='\033[0;31m'
+ GREEN='\033[0;32m'
+ YELLOW='\033[1;33m'
+ BLUE='\033[0;34m'
+ NC='\033[0m' # No Color
+ 
+ # ログレベル
+ LOG_LEVEL_DEBUG=0
+ LOG_LEVEL_INFO=1
+ LOG_LEVEL_WARN=2
+ LOG_LEVEL_ERROR=3
+ 
+ # デフォルトのログレベル
+ CURRENT_LOG_LEVEL=$LOG_LEVEL_INFO
+ 
+ # ログ出力関数
+ log() {
+     local level=$1
+     local message=$2
+     local timestamp=$(date '+%Y-%m-%d %H:%M:%S')
+ 
+     if [ $level -ge $CURRENT_LOG_LEVEL ]; then
+         case $level in
+             $LOG_LEVEL_DEBUG)
+                 echo -e "${BLUE}[DEBUG]${NC} ${timestamp} - ${message}"
+                 ;;
+             $LOG_LEVEL_INFO)
+                 echo -e "${GREEN}[INFO]${NC} ${timestamp} - ${message}"
+                 ;;
+             $LOG_LEVEL_WARN)
+                 echo -e "${YELLOW}[WARN]${NC} ${timestamp} - ${message}"
+                 ;;
+             $LOG_LEVEL_ERROR)
+                 echo -e "${RED}[ERROR]${NC} ${timestamp} - ${message}"
+                 ;;
+         esac
+     fi
+ }
+ 
+ # エラーハンドリング関数
+ handle_error() {
+     local error_message=$1
+     local exit_code=${2:-1}
+     log $LOG_LEVEL_ERROR "$error_message"
+     exit $exit_code
+ }
+ 
+ # 依存関係チェック
+ check_dependency() {
+     local command=$1
+     if ! command -v "$command" &> /dev/null; then
+         handle_error "Required command '$command' is not installed."
+     fi
+ }
+ 
+ # ディレクトリ作成（存在確認付き）
+ create_directory() {
+     local dir_path=$1
+     if [ ! -d "$dir_path" ]; then
+         mkdir -p "$dir_path" || handle_error "Failed to create directory: $dir_path"
+         log $LOG_LEVEL_INFO "Created directory: $dir_path"
+     else
+         log $LOG_LEVEL_DEBUG "Directory already exists: $dir_path"
+     fi
+ }
+ 
+ # ファイルのバックアップ作成
+ backup_file() {
+     local file_path=$1
+     local backup_path="${file_path}.bak"
+     if [ -f "$file_path" ]; then
+         cp "$file_path" "$backup_path" || handle_error "Failed to create backup: $file_path"
+         log $LOG_LEVEL_INFO "Created backup: $backup_path"
+     fi
+ }
+ 
+ # YAMLファイルの存在確認
+ check_yaml_file() {
+     local file_path=$1
+     if [ ! -f "$file_path" ]; then
+         handle_error "YAML file not found: $file_path"
+     fi
+ }
+ 
+ # 設定ファイルのロード
+ load_config() {
+     local config_file=$1
+     check_yaml_file "$config_file"
+     # yqコマンドの存在確認
+     check_dependency "yq"
+     # 設定ファイルの読み込み（実装予定）
+     log $LOG_LEVEL_DEBUG "Loading config file: $config_file"
+ }
+ 
+ # パスの正規化
+ normalize_path() {
+     local path=$1
+     echo "$(cd "$(dirname "$path")" && pwd)/$(basename "$path")"
+ }
+ 
+ # 文字列がJSON/YAML配列形式かチェック
+ is_array_string() {
+     local str=$1
+     [[ $str == \[*\] ]]
+ }
+ 
+ # コンマ区切り文字列を配列に変換
+ split_string() {
+     local IFS=','
+     read -ra ADDR <<< "$1"
+     echo "${ADDR[@]}"
+ }
+ 
+ # 配列の要素数を取得
+ get_array_length() {
+     local array=("$@")
+     echo "${#array[@]}"
+ }
+ 
+ # 配列の要素を検証
+ validate_array_length() {
+     local array1=("$1")
+     local array2=("$2")
+     local name1=$3
+     local name2=$4
+     
+     if [ "${#array1[@]}" != "${#array2[@]}" ]; then
+         handle_error "Number of ${name1} (${#array1[@]}) does not match number of ${name2} (${#array2[@]})"
+     fi
+ }
+ 
+ # スクリプトの実行に必要な環境変数の設定
+ setup_environment() {
+     # タスク管理システムのルートディレクトリ
+     export TASK_ROOT="$(cd "$(dirname "${BASH_SOURCE[0]}")/../.." && pwd)"
+     # 各種ディレクトリパスの設定
+     export TASKS_DIR="${TASK_ROOT}/tasks"
+     export TEMPLATES_DIR="${TASKS_DIR}/templates"
+     export CONFIG_DIR="${TASKS_DIR}/config"
+     export LIB_DIR="${TASK_ROOT}/lib"
+     
+     log $LOG_LEVEL_DEBUG "Environment setup completed"
+     log $LOG_LEVEL_DEBUG "TASK_ROOT: ${TASK_ROOT}"
+ }
+ 
+ # 初期化時に環境をセットアップ
+ setup_environment 
```

---

_****_

次に、入力検証用の関数を実装します：

---

_****_

```diff
- 
+ #!/bin/bash
+ 
+ # 入力検証関数
+ 
+ # 共通ユーティリティ関数の読み込み
+ source "$(dirname "${BASH_SOURCE[0]}")/common.sh"
+ 
+ # タスクIDの形式を検証
+ validate_task_id() {
+     local task_id=$1
+     if [[ ! $task_id =~ ^[A-Z]{2}[0-9]{2}$ ]]; then
+         handle_error "Invalid task ID format: $task_id (expected format: AA00)"
+     fi
+ }
+ 
+ # タスク名の検証
+ validate_task_name() {
+     local task_name=$1
+     if [ -z "$task_name" ]; then
+         handle_error "Task name cannot be empty"
+     fi
+     if [ ${#task_name} -gt 100 ]; then
+         handle_error "Task name is too long (max 100 characters)"
+     fi
+ }
+ 
+ # タスクステータスの検証
+ validate_task_status() {
+     local status=$1
+     local valid_statuses=("not_started" "in_progress" "completed")
+     local valid=false
+     
+     for valid_status in "${valid_statuses[@]}"; do
+         if [ "$status" = "$valid_status" ]; then
+             valid=true
+             break
+         fi
+     done
+     
+     if [ "$valid" = false ]; then
+         handle_error "Invalid task status: $status (valid: ${valid_statuses[*]})"
+     fi
+ }
+ 
+ # 必須パラメータの検証
+ validate_required_param() {
+     local param_value=$1
+     local param_name=$2
+     
+     if [ -z "$param_value" ]; then
+         handle_error "Required parameter '$param_name' is missing"
+     fi
+ }
+ 
+ # ファイルパスの検証
+ validate_file_path() {
+     local file_path=$1
+     local create_if_missing=${2:-false}
+     
+     if [ ! -e "$file_path" ]; then
+         if [ "$create_if_missing" = true ]; then
+             touch "$file_path" || handle_error "Failed to create file: $file_path"
+             log $LOG_LEVEL_INFO "Created file: $file_path"
+         else
+             handle_error "File not found: $file_path"
+         fi
+     fi
+ }
+ 
+ # ディレクトリパスの検証
+ validate_directory() {
+     local dir_path=$1
+     local create_if_missing=${2:-false}
+     
+     if [ ! -d "$dir_path" ]; then
+         if [ "$create_if_missing" = true ]; then
+             create_directory "$dir_path"
+         else
+             handle_error "Directory not found: $dir_path"
+         fi
+     fi
+ }
+ 
+ # YAMLファイルの構文検証
+ validate_yaml_syntax() {
+     local yaml_file=$1
+     check_dependency "yq"
+     
+     if ! yq eval '.' "$yaml_file" > /dev/null 2>&1; then
+         handle_error "Invalid YAML syntax in file: $yaml_file"
+     fi
+ }
+ 
+ # テンプレート名の検証
+ validate_template_name() {
+     local template_name=$1
+     local valid_templates=("default" "compact" "detailed")
+     local valid=false
+     
+     for valid_template in "${valid_templates[@]}"; do
+         if [ "$template_name" = "$valid_template" ]; then
+             valid=true
+             break
+         fi
+     done
+     
+     if [ "$valid" = false ]; then
+         handle_error "Invalid template name: $template_name (valid: ${valid_templates[*]})"
+     fi
+ }
+ 
+ # コマンドライン引数の数を検証
+ validate_args_count() {
+     local actual=$1
+     local expected=$2
+     local command=$3
+     
+     if [ "$actual" -ne "$expected" ]; then
+         handle_error "Invalid number of arguments for '$command' command. Expected $expected, got $actual"
+     fi
+ }
+ 
+ # 数値の検証
+ validate_number() {
+     local number=$1
+     local param_name=$2
+     
+     if ! [[ "$number" =~ ^[0-9]+$ ]]; then
+         handle_error "Invalid $param_name: $number (must be a number)"
+     fi
+ }
+ 
+ # 日付形式の検証
+ validate_date() {
+     local date=$1
+     local param_name=$2
+     
+     if ! date -d "$date" > /dev/null 2>&1; then
+         handle_error "Invalid $param_name format: $date (expected format: YYYY-MM-DD)"
+     fi
+ } 
```

---

_****_

ここまでの実装で、基本的なユーティリティ関数とバリデーション機能が整いました。タスクリストを更新します：

---

_****_

```diff
  - [x] 設定ファイルの作成
  - [x] 依存関係の確認と必要なツールのインストール確認（yq, jq）
- - [ ] メインの task コマンドスクリプトの実装
-   - [ ] 基本的なコマンド構造の実装
-   - [ ] サブコマンドのディスパッチ機能
-   - [ ] ヘルプメッセージの実装
-   - [ ] エラーハンドリングの基本実装
+ - [x] メインの task コマンドスクリプトの実装
+   - [x] 基本的なコマンド構造の実装
+   - [x] サブコマンドのディスパッチ機能
+   - [x] ヘルプメッセージの実装
+   - [x] エラーハンドリングの基本実装
  - [ ] 初期化コマンド（task start/init）の実装
    - [ ] ディレクトリ構造作成機能
  - [x] テンプレートエンジン（template_engine.sh）の実装
  - [x] 既存のtask_processor.shの修正
- - [ ] 共通ユーティリティ関数の実装
-   - [ ] ログ出力機能
-   - [ ] エラーハンドリング機能
-   - [ ] 入力検証機能
+ - [x] 共通ユーティリティ関数の実装
+   - [x] ログ出力機能
+   - [x] エラーハンドリング機能
+   - [x] 入力検証機能
  
  ## 3. コマンドモジュール実装
  - ファイル構造の見直し: tasksディレクトリへの集約
  - 実装計画の詳細化
+ - メインの task.sh スクリプトを実装:
+   - コマンドディスパッチ機能
+   - ヘルプメッセージ
+   - バージョン情報
+ - 共通ユーティリティ関数を実装:
+   - ログ出力機能
+   - エラーハンドリング
+   - ファイル操作
+   - 環境設定
+ - 入力検証関数を実装:
+   - タスクID検証
+   - タスク名検証
+   - ステータス検証
+   - パラメータ検証
+   - ファイル/ディレクトリパス検証
+   - YAML構文検証
+ 
+ ### 次のステップ
+ 1. 初期化モジュール（lib/core/task_init.sh）の実装
+ 2. 初期化コマンド（lib/commands/task_init.sh）の実装
+ 3. 必要なテンプレートファイルの作成
  
  ## 注意点
```

---

_****_

次に、初期化モジュールの実装に移りますが、その前にディレクトリ構造を作成する必要があります：

---

_****_

Cancelled

---

_****_



---



---

